?apply
z <- array(1:24, dim = 2:4)
zseq <- apply(z, 1:2, function(x) seq_len(max(x)))
zseq         ## a 2 x 3 matrix
View(zseq)
z
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
library(UsingR)
library(tidyverse)
library(grid)
library(png)
# n - total count of trials, count of observations, or sample size
# x_val - number of trials, or number of observations
# y_val - cumulative means
n <- 10000
df <- data_frame(x_val = 1:n, y_val = cumsum(rnorm(n))/(1:n))
ggplot(df, aes(x=x_val, y=y_val)) +
geom_hline(yintercept=0) +
geom_line(size=1) +
labs(x="Number of obs", y="Cumulative mean")
# n - total count of trials, count of observations, or sample size
# x_val - number of trials, or number of observations
# y_val - cumulative means
n <- 10000
df <- data.frame(x_val=1:n, y_val=cumsum(sample(0:1,n,replace=TRUE))/(1:n))
ggplot(df, aes(x=x_val, y=y_val)) +
geom_hline(yintercept=0.5) +
geom_line(size=1) +
labs(x="Number of obs", y="Cumulative mean")
# n - total count of trials, or sample size
sim_count <- 1000
cfunc <- function(x, n) (mean(x) - 3.5) / 1.71 / sqrt(n)
df <- data.frame(
x_val=c(apply(matrix(sample(1:6, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(1:6, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(1:6, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
sample_size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=sample_size)) +
geom_histogram(alpha=.20, binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ sample_size)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
sim_count <- 1000
cfunc <- function(x, n) sqrt(n)*(mean(x) - 0.9) / sqrt(.1*.9)
df <- data.frame(
x=c(apply(matrix(sample(0:1, prob=c(.1,.9), sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, prob=c(.1,.9), sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, prob=c(.1,.9), sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x, fill=size)) +
geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
library(UsingR);data(father.son); x <- father.son$sheight
(mean(x) + c(-1, 1)*qnorm(.975)*sd(x) / sqrt(length(x))) / 12
round(1 / sqrt(10 ^ (1:6)), 3)
.56 + c(-1, 1)*qnorm(.975)*sqrt(.56*.44 / 100)
binom.test(56, 100)$conf.int
n <- 20; pvals <- seq(.1, .9, by=.05); sim_count <- 1000
coverage <- sapply(pvals, function(p){
phats <- rbinom(sim_count, prob=p, size=n) / n
ll <- phats - qnorm(.975)*sqrt(phats*(1 - phats) / n)
ul <- phats + qnorm(.975)*sqrt(phats*(1 - phats) / n)
mean(ll < p & ul > p)
})
ggplot(data.frame(pvals, coverage), aes(x=pvals, y=coverage)) + geom_line(size=2) + geom_hline(yintercept=0.95) + ylim(.75, 1.0)
n <- 100; pvals <- seq(.1, .9, by=.05); sim_count <- 1000
coverage2 <- sapply(pvals, function(p){
phats <- rbinom(sim_count, prob=p, size=n) / n
ll <- phats - qnorm(.975)*sqrt(phats*(1 - phats) / n)
ul <- phats + qnorm(.975)*sqrt(phats*(1 - phats) / n)
mean(ll < p & ul > p)
})
ggplot(data.frame(pvals, coverage), aes(x=pvals, y=coverage2)) + geom_line(size=2) + geom_hline(yintercept=0.95)+ ylim(.75, 1.0)
n <- 20; pvals <- seq(.1, .9, by=.05); sim_count <- 1000
coverage <- sapply(pvals, function(p){
phats <- (rbinom(sim_count, prob=p, size=n) + 2) / (n + 4)
ll <- phats - qnorm(.975)*sqrt(phats*(1 - phats) / n)
ul <- phats + qnorm(.975)*sqrt(phats*(1 - phats) / n)
mean(ll < p & ul > p)
})
ggplot(data.frame(pvals, coverage), aes(x=pvals, y=coverage)) + geom_line(size=2) + geom_hline(yintercept=0.95)+ ylim(.75, 1.0)
x <- 5; t <- 94.32; lambda <- x / t
round(lambda + c(-1, 1)*qnorm(.975)*sqrt(lambda / t), 3)
poisson.test(x, T=94.32)$conf
lambdavals <- seq(0.005, 0.10, by=.01); sim_count <- 1000
t <- 100
coverage <- sapply(lambdavals, function(lambda){
lhats <- rpois(sim_count, lambda=lambda*t) / t
ll <- lhats - qnorm(.975)*sqrt(lhats / t)
ul <- lhats + qnorm(.975)*sqrt(lhats / t)
mean(ll < lambda & ul > lambda)
})
ggplot(data.frame(lambdavals, coverage), aes(x=lambdavals, y=coverage)) + geom_line(size=2) + geom_hline(yintercept=0.95)+ylim(0, 1.0)
lambdavals <- seq(0.005, 0.10, by=.01)
sim_count <- 1000
t <- 1000
coverage <- sapply(lambdavals, function(lambda){
lhats <- rpois(sim_count, lambda=lambda*t) / t
ll <- lhats - qnorm(.975)*sqrt(lhats / t)
ul <- lhats + qnorm(.975)*sqrt(lhats / t)
mean(ll < lambda & ul > lambda)
})
ggplot(data.frame(lambdavals, coverage), aes(x=lambdavals, y=coverage)) + geom_line(size=2) + geom_hline(yintercept=0.95) + ylim(0, 1.0)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x_val=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
View(df)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x_val=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm(2,2), size=2) +
facet_grid(. ~ size)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x_val=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x_val=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=4) +
facet_grid(. ~ size)
sim_count <- 1000
cfunc <- function(x, n) 2*sqrt(n)*(mean(x) - 0.5)
df <- data.frame(
x_val=c(apply(matrix(sample(0:1, sim_count*10, replace=TRUE), sim_count), 1, cfunc, 10),
apply(matrix(sample(0:1, sim_count*20, replace=TRUE), sim_count), 1, cfunc, 20),
apply(matrix(sample(0:1, sim_count*30, replace=TRUE), sim_count), 1, cfunc, 30)
),
size=factor(rep(c(10, 20, 30), rep(sim_count, 3))))
ggplot(df, aes(x=x_val, fill=size)) + geom_histogram(binwidth=.3, colour="black", aes(y=..density..)) +
stat_function(fun=dnorm, size=2) +
facet_grid(. ~ size)
